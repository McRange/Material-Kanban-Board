var materialKanban=function(){"use strict";var e={version:"1.0.2b",escapeHTML:function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}try{return apex.util.escapeHTML(String(e))}catch(a){return(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},loader:{start:function(e){try{apex.util.showSpinner($(e))}catch(t){var a=$("<span></span>");a.attr("id","loader"+e),a.addClass("ct-loader fa-stack fa-3x");var r=$("<i></i>");r.addClass("fa fa-circle fa-stack-2x"),r.css("color","rgba(121,121,121,0.6)");var n=$("<i></i>");n.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),n.css("animation-duration","1.8s"),a.append(r),a.append(n),$(e).append(a)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(e,a,r){null==r&&(r=!0);var n={};if("string"==typeof a)try{a=JSON.parse(a)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(a)}else n=a;try{n=$.extend(r,[],e,a)}catch(a){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(a),n=e,console.error(n)}return n},noDataMessage:{show:function(e,a){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),t=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(t);var o=$("<span></span>").text(a).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(o),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},groupBy:function(e,a){var r=new Map;return e.forEach(function(e){var n=a(e);r.has(n)?r.get(n).push(e):r.set(n,[e])}),r}};return{initialize:function(a,r,n,t,o,s,d,i,l){var c={},p=(c=e.jsonSaveExtend({refresh:0,staticColumns:[{COLUMN_ID:"1",COLUMN_TITLE:"To Do",COLUMN_ICON:"fa-calendar"},{COLUMN_ID:"2",COLUMN_TITLE:"In Progress",COLUMN_ICON:"fa-wrench"},{COLUMN_ID:"3",COLUMN_TITLE:"Done",COLUMN_ICON:"fa-check"}],dynamicColumns:!1,groupExtension:!1,groupColWidth:6,allowDragItemsBetweenGroups:!1,groupCollapsible:!1,printDataToConsole:!1},t,!1)).staticColumns,O=null,C=null,u=null,L=null,g=0,I=100,_=$("#"+a);if(_.length>0){L=function(e){var a=$("<div></div>");return a.addClass("s-g-container"),a.css("min-height","170px"),e.append(a),a}(_),f();try{apex.jQuery("#"+s).bind("apexrefresh",function(){0==L.children("span").length&&(C&&C.destroy(),u&&u.destroy(),f())})}catch(e){console.log("Can't bind refresh event on "+s+". Apex is missing"),console.log(e)}c.refresh>0&&setInterval(function(){0==L.children("span").length&&(C&&C.destroy(),u&&u.destroy(),f())},1e3*c.refresh)}else console.log("Can't find parentID: "+a);function f(){if(r)e.loader.start(L),apex.server.plugin(r,{pageItems:o,x01:"getData"},{success:function(e){_.trigger("materialkanbandataloaded"),v(e),_.trigger("materialkanbandatarendered")},error:function(e){L.empty(),console.log(e.responseText)},dataType:"json"});else try{e.loader.start(L),setTimeout(function(){v(dataJSON)},500)}catch(e){console.log("need data json"),console.log(e)}}function v(a){if(c.printDataToConsole&&(console.log(JSON.stringify(a)),console.log(a)),O=a.row,L.empty(),c.dynamicColumns){var t=[];e.groupBy(a.row,function(e){return e.COLUMN_ID}).forEach(function(e,a,r){a&&t.push(e[0])}),p=t}if($.each(p,function(a,r){!1!==d&&(r.COLUMN_ID=e.escapeHTML(r.COLUMN_ID),r.COLUMN_TITLE=e.escapeHTML(r.COLUMN_TITLE),r.COLUMN_ICON=e.escapeHTML(r.COLUMN_ICON),r.COLUMN_ICON_COLOR=e.escapeHTML(r.COLUMN_ICON_COLOR),r.COLUMN_HEADER_STYLE=e.escapeHTML(r.COLUMN_HEADER_STYLE),r.COLUMN_COLOR=e.escapeHTML(r.COLUMN_COLOR)),null==r.COLUMN_COLOR&&(r.COLUMN_COLOR="hsl("+46*a%350+", 55%, 60%)"),r.COLUMN_INDEX=r.COLUMN_INDEX?r.COLUMN_INDEX:a}),p&&p.length>0){g=c.groupExtension?100/(12*p.length/c.groupColWidth+1):0,I=(100-g)/p.length,g=Math.floor(100*g)/100,I=Math.floor(100*I)/100,function(e){var a=N(e);if(a.addClass("kb-row"),c.groupExtension){var r=$("<div></div>");r.addClass("kb-col kb-col-header"),r.attr("style","width:"+g+"%"),a.append(r)}$.each(p,function(e,n){(r=$("<div></div>")).addClass("kb-col kb-col-header"),r.attr("style","width:"+I+"%"),r.attr("id",n.COLUMN_ID);var t=$("<div></div>");t.addClass("kb-col-header-content");var o="border-top-color: "+n.COLUMN_COLOR+";";t.attr("style",n.COLUMN_HEADER_STYLE||o);var s=null!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";t.append('<p class="title">'+s+"</p>"),r.append(t),a.append(r)})}(L);var s=N(L);if(s.addClass("kb-group-container"),a.row&&a.row.length>0){e.groupBy(a.row,function(e){return c.groupExtension?e.GROUP_ID:1}).forEach(function(a,r,n){if(r){var t=N(s);t.addClass("kb-row"),t.attr("groupid",r),c.groupExtension&&function(a,r){!1!==d&&(r.GROUP_ID=e.escapeHTML(r.GROUP_ID),r.GROUP_ICON=e.escapeHTML(r.GROUP_ICON),r.GROUP_ICON_COLOR=e.escapeHTML(r.GROUP_ICON_COLOR),r.GROUP_HEADER_STYLE=e.escapeHTML(r.GROUP_HEADER_STYLE),r.GROUP_TITLE=e.escapeHTML(r.GROUP_TITLE),r.GROUP_FOOTER=e.escapeHTML(r.GROUP_FOOTER));var n=$("<div></div>");n.addClass("kb-col kb-group-region"),n.attr("style","width:"+g+"%"),a.append(n);var t=T(n,{isGroupCard:!0,ID:r.GROUP_ID,ICON:r.GROUP_ICON,ICON_COLOR:r.GROUP_ICON_COLOR,HEADER_STYLE:r.GROUP_HEADER_STYLE,TITLE:r.GROUP_TITLE,FOOTER:r.GROUP_FOOTER,LINK:r.GROUP_LINK});if(t.addClass("kb-group-card"),c.groupCollapsible){var o=$("<i></i>");o.addClass("fa fa-chevron-down");var s=$("<div></div>");s.addClass("kb-collapsable kb-collapse"),s.append(o),$(t.find(".card-header")[0]).before(s);var i=$("<i></i>");i.addClass("fa fa-chevron-up");var l=$("<div></div>");l.addClass("kb-collapsable kb-expand"),l.append(i),$(t.find(".card-header")[0]).before(l),l.attr("style","display:none")}}(t,a[0]),$.each(p,function(r,n){!function(a,r,n){var t=$("<div></div>");t.addClass("kb-col kb-item-region"),t.attr("style","width:"+I+"%"),a.append(t);var o=$("<div></div>");o.addClass("kb-col-content");var s="border-left-color: "+n.COLUMN_COLOR+";";o.attr("style",n.COLUMN_HEADER_STYLE||s),t.append(o);var i=$("<div></div>");i.addClass("kb-col-inner-header");var l=null!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";i.append('<p class="title">'+l+"</p>"),o.append(i);var c=$("<div></div>");if(c.addClass("kb-item-container"),c.attr("columnid",n.COLUMN_ID),o.append(c),0==n.COLUMN_INDEX){var p=r.filter(function(e){return e.GROUP_NEW_ITEM_LINK});p.length>0&&(c.addClass("kb-item-container-with-new-card"),E(o,p[0].GROUP_NEW_ITEM_LINK))}!function(a,r,n){a&&a.length>0&&$.each(a,function(a,t){!1!==d&&(t.ID=e.escapeHTML(t.ID),t.ICON=e.escapeHTML(t.ICON),t.ICON_COLOR=e.escapeHTML(t.ICON_COLOR),t.HEADER_STYLE=e.escapeHTML(t.HEADER_STYLE),t.TITLE=e.escapeHTML(t.TITLE),t.TITLE_STYLE=e.escapeHTML(t.TITLE_STYLE),t.FOOTER=e.escapeHTML(t.FOOTER),t.FILL_BG_COLOR=e.escapeHTML(t.FILL_BG_COLOR),t.FILL_BG_WIDTH=e.escapeHTML(t.FILL_BG_WIDTH)),T(r,{isGroupCard:!1,ID:t.ID,ICON:t.ICON,ICON_COLOR:t.ICON_COLOR,HEADER_STYLE:t.HEADER_STYLE,TITLE:t.TITLE,TITLE_STYLE:t.TITLE_STYLE,FOOTER:t.FOOTER,LINK:t.LINK,FILL_BG_COLOR:t.FILL_BG_COLOR,FILL_BG_WIDTH:t.FILL_BG_WIDTH},n)})}(r.filter(function(e){return e.COLUMN_ID==n.COLUMN_ID&&e.ID}),c,n)}(t,a,n)}),c.groupExtension&&c.groupCollapsible&&(t.find(".kb-collapsable").click(function(){R(t,!0)}),1===a[0].GROUP_COLLAPESED&&R(t,!1))}});var f=a.row.filter(function(e){return e.NEW_GROUP_LINK});c.groupExtension&&f.length>0&&function(e,a){var r=N(e);r.addClass("kb-row");var e=r,n=$("<div></div>");n.addClass("kb-group-region kb-new-group-region"),e.append(n),E(n,a)}(L,f[0].NEW_GROUP_LINK),i&&(v=0,M=null,C=dragula($(_.find(".kb-item-container")).toArray(),{direction:"vertical",accepts:function(e,a,r,n){return!!c.allowDragItemsBetweenGroups||$(r).closest(".kb-row").attr("groupid")==$(a).closest(".kb-row").attr("groupid")}}),$(".kb-item-container > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),C.on("drag",function(e,a){var r=$(e),n=$(a);v=r.index();var t=r.next();M=t.length>0?$(t[0]):null;var o={itemId:r.attr("itemid"),sourceGroupId:n.closest(".kb-row").attr("groupid"),sourceColumnId:n.attr("columnid"),sourceItemIndex:v};_.trigger("materialkanbandrag",[o])}),C.on("drop",function(e,a,n,t){var s=$(e),d=$(a),i=$(n),l={itemId:s.attr("itemid"),sourceGroupId:i.closest(".kb-row").attr("groupid"),sourceColumnId:i.attr("columnid"),sourceItemIndex:v,targetGroupId:d.closest(".kb-row").attr("groupid"),targetColumnId:d.attr("columnid"),targetItemIndex:s.index()};try{apex.server.plugin(r,{pageItems:o,x01:"moveItem",x02:l.itemId,x03:l.sourceGroupId,x04:l.sourceColumnId,x05:l.sourceItemIndex,x06:l.targetGroupId,x07:l.targetColumnId,x08:l.targetItemIndex},{success:function(e){},error:function(e){M?s.insertBefore(M):i.append(s),h(s,i.attr("columnid")),console.error(e.responseText),_.trigger("materialkanbandroperror",[l])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}h(s,d.attr("columnid")),_.trigger("materialkanbandrop",[l])}),c.groupExtension&&l&&function(){var e=0,a=null;u=dragula($(_.find(".kb-group-container")).toArray(),{direction:"vertical",moves:function(e,a,r){var n=$(r).closest(".kb-group-card");return n.length>0}}),$(".kb-group-region > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),u.on("drag",function(r,n){var t=$(r);e=t.index();var o=t.next();a=o.length>0?$(o[0]):null;var s={groupId:t.attr("groupid"),sourceGroupIndex:e};_.trigger("materialkanbandraggroup",[s])}),u.on("drop",function(n,t,s,d){var i=$(n),l=($(t),$(s)),c={groupId:i.attr("groupid"),sourceGroupIndex:e,targetGroupIndex:i.index()};try{apex.server.plugin(r,{pageItems:o,x01:"moveGroup",x02:c.groupId,x03:c.sourceGroupIndex,x04:c.targetGroupIndex},{success:function(e){},error:function(e){a?i.insertBefore(a):l.append(i),console.error(e.responseText),_.trigger("materialkanbandroperror",[c])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}_.trigger("materialkanbandropgroup",[c])})}())}else s.css("min-height",""),e.noDataMessage.show(s,n)}else console.log("No columns defined!");var v,M}function N(e){var a=$("<div></div>");return a.addClass("s-g-row"),e.append(a),a}function T(e,a,r){var n=$("<div></div>");if(n.addClass("kb-card"),n.attr("itemid",a.ID),a.FILL_BG_COLOR||a.FILL_BG_WIDTH){var t=$("<div></div>");t.addClass("card-bg-fillable"),a.FILL_BG_COLOR?t.css("background-color",a.FILL_BG_COLOR):r&&r.COLUMN_COLOR&&(t.css("background-color",r.COLUMN_COLOR),t.css("opacity","0.2")),a.FILL_BG_WIDTH?t.css("width",a.FILL_BG_WIDTH+"%"):t.css("width","100%"),n.append(t)}var o=$("<div></div>");if(o.addClass("card-header"),"none"!==a.ICON&&(a.ICON||r&&r.COLUMN_ICON)){var s=$("<i></i>");s.addClass("fa "+(a.ICON||r.COLUMN_ICON)),(a.ICON_COLOR&&a.ICON_COLOR.length>0||r&&r.COLUMN_ICON_COLOR&&r.COLUMN_ICON_COLOR.length>0)&&s.attr("style","color:"+(a.ICON_COLOR||r.COLUMN_ICON_COLOR)),o.append(s)}a.HEADER_STYLE?o.attr("style",a.HEADER_STYLE):r&&r.COLUMN_COLOR&&o.attr("style","background:"+r.COLUMN_COLOR),n.append(o);var d=$("<div></div>");d.addClass("card-content");var i=a.TITLE?a.TITLE:"",l=a.TITLE_STYLE?a.TITLE_STYLE:"";if(d.append('<p class="title" style="'+l+'">'+i+"</p>"),a.LINK){var c=$("<a></a>");c.attr("href",a.LINK),c.append(d),n.append(c)}else n.append(d);if(a.FOOTER){var p=$("<div></div>");p.addClass("card-footer");var O=$("<div></div>");O.append(a.FOOTER),p.append(O),n.append(p)}return e.append(n),n}function E(e,a){var r=$("<div></div>");r.addClass("kb-new-card");var n=$("<i></i>");n.addClass("fa fa-plus"),r.append(n);var t=$("<a></a>");t.attr("href",a),t.append(r);var o=$("<div></div>");o.addClass("kb-new-item-region"),o.append(t),e.append(o)}function h(e,a){var r=e.attr("itemid"),n=O.find(function(e){return e.ID==r}),t=p.find(function(e){return e.COLUMN_ID==a}),o=e.find(".card-header"),s=o.find("i");(n&&n.ICON||t&&t.COLUMN_ICON)&&(s.removeClass().addClass("fa "+(n.ICON||t.COLUMN_ICON)),(n.ICON_COLOR&&n.ICON_COLOR.length>0||t&&t.COLUMN_ICON_COLOR&&t.COLUMN_ICON_COLOR.length>0)&&s.attr("style","color:"+(n.ICON_COLOR||t.COLUMN_ICON_COLOR))),!n.HEADER_STYLE&&t&&t.COLUMN_COLOR&&o.attr("style","background:"+t.COLUMN_COLOR)}function R(e,a){e.find(".kb-collapsable").toggle(),e.find(".card-footer").toggle(),e.find(".kb-item-region").toggle();var r=e.find(".kb-group-region");if(r.toggleClass("kb-collapsed"),a){var n={groupId:e.attr("groupid"),collapsed:r.hasClass("kb-collapsed")};_.trigger("materialkanbangroupcollapsed",[n])}}}}}();